ScriptAlias /api/ /app/cgi-bin/
<Directory "/app/cgi-bin">
    AllowOverride None
    Options +ExecCGI
    SetHandler cgi-script

    # Basic Authentication
    AuthType Basic
    AuthName "Internet Control Access"
    AuthUserFile /app/config/.htpasswd
    Require valid-user
</Directory>

# Enable required modules
LoadModule cgi_module /usr/lib/apache2/modules/mod_cgi.so
LoadModule auth_basic_module /usr/lib/apache2/modules/mod_auth_basic.so
LoadModule authn_file_module /usr/lib/apache2/modules/mod_authn_file.so
LoadModule authz_user_module /usr/lib/apache2/modules/mod_authz_user.so

# Basic security headers
Header set X-Frame-Options "SAMEORIGIN"
Header set X-XSS-Protection "1; mode=block"
Header set X-Content-Type-Options "nosniff"

# Enable CORS with auth support
Header set Access-Control-Allow-Origin "*"
Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
Header set Access-Control-Allow-Headers "Authorization, Content-Type"
Header set Access-Control-Expose-Headers "Authorization"

# Log configuration
LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
CustomLog ${APACHE_LOG_DIR}/access.log combined
ErrorLog ${APACHE_LOG_DIR}/error.log